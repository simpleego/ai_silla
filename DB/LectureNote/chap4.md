# Chapter 04. SQL 고급

내장 함수

부속질의

뷰

인덱스

내장 함수의 의미를 알아보고 자주 사용되는 내장 함수 몇 가지를 직접 실습해 본다

부속질의의 의미와 종류를 알아보고 직접 실습해 본다\.

뷰의 의미를 알아보고 뷰를 직접 생성\, 수정\, 삭제해 본다\.

데이터베이스의 저장 구조와 인덱스의 관계를 알아보고 인덱스를 직접 생성\, 수정\, 삭제해 본다\.

# 01. 내장함수

SQL 내장 함수

NULL 값 처리

ROWNUM



* SQL에서는 함수의 개념을 사용하는데 수학의 함수와 마찬가지로 특정 값이나 열의 값을 입력받아 그 값을 계산하여 결과 값을 돌려줌\.
  * 함수의 원리
* SQL의 함수는 DBMS가 제공하는 내장 함수\(built\-in function\)와 사용자가 필요에 따라 직접 만드는 사용자 정의 함수\(user\-defined function\)로 나뉨\.


![image](./img/%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_0.jpg)

![image](https://github.com/user-attachments/assets/02d59d9f-423f-4736-98b2-81c2e86f2cc1)


# 1.1 SQL 내장함수

SQL 내장 함수는 상수나 속성 이름을 입력 값으로 받아 단일 값을 결과로 반환함\.

모든 내장 함수는 최초에 선언될 때 유효한 입력 값을 받아야 함\.

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_1.jpg)

# 숫자 함수

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_2.jpg)



* ABS 함수 : 절댓값을 구하는 함수
* ROUND 함수 : 반올림한 값을 구하는 함수
* 숫자 함수의 연산


__질의 __  __4\-1   \-78__  __과 __  __\+78__  __의 절댓값을 __  __구하시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_3.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_4.jpg)

__질의 __  __4\-2   4\.875__  __를__  __ __  __소수 첫째 자리까지 반올림한 값을 구하시요__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_5.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_6.jpg)

__질의 __  __4\-3   __  __고객별 평균 주문 금액을 배 원 단위로 반올림한 값을 구하시요__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_7.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_8.jpg)

# 문자 함수

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_9.jpg)

REPLACE : 문자열을 치환하는 함수

__질의 __  __4\-4   __  __도서제목에 야구가 포함된 도서를 농구로 변경한 후 도서 목록을 __  __보이시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_10.jpg)

LENGTH : 글자의 수를 세어주는 함수 \(단위가 바이트\(byte\)가 아닌 문자 단위\)

SUBSTR : 지정한 길이만큼의 문자열을 반환하는 함수

__질의 __  __4\-5   __  __굿스포츠에서 출판한 도서의 제목과 제목의 글자 수를 __  __확인하시오__  __\.__

__             __  __ \(__  __한글은 __  __2__  __바이트 혹은 __  __UNICODE __  __경우는 __  __3__  __바이트를 차지함__  __\)__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_11.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_12.jpg)

__질의 __  __4\-6   __  __마당서점의 고객 중에서 같은 성__  __\(__  __姓__  __\)__  __을 가진 사람이 몇 명이나 되는지 성별  __  __              __  __인원수를 __  __구하시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_13.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_14.jpg)

# 날짜ㆍ시간 함수

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_15.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_16.jpg)

__질의 __  __4\-7   __  __마당서점은 주문일로부터 __  __10__  __일 후 매출을 확정한다__  __\. __  __각 주문의 확정일자를 __  __구하시오__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_17.jpg)

TO\_DATE : 문자형으로 저장된 날짜를 날짜형으로 변환하는 함수

TO\_CHAR : 날짜형을 문자형으로 변환하는 함수

__질의 __  __4\-8  __  __ 마당서점이 __  __2014__  __년 __  __7__  __월 __  __7__  __일에 __  __주문받은__  __ 도서의 주문번호__  __\, __  __주문일__  __\, __  __고객번호__  __\, __  __              __  __도서번호를 모두 __  __보이시오__  __\.  __  __단 주문일은 ‘__  __yyyy__  __\-mm\-dd __  __요일’ 형태로 표시__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_18.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_19.jpg)

SYSDATETIME  : 오라클의 현재 날짜와 시간을 반환하는 함수

SYSTIMESTAMP : 현재 날짜\, 시간과 함께 초 이하의 시간과 서버의 TIMEZONE까지                          출력함

__질의 __  __4\-9  __  __ __  __DBMS __  __서버에 설정된 현재 시간과 오늘 날짜를 __  __확인하시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_20.jpg)

# 연습문제



* 다음 내장 함수의 결과를 적으시오\.
      * ABS\(\-15\)
      * CEIL\(15\.7\)
      * COS\(3\.14159\)
      * FLOOR\(15\.7\)
      * LOG\(10\,100\)
      * MOD\(11\,4\)
      * POWER\(3\,2\)
      * ROUND\(15\.7\)
      * SIGN\(\-15\)
      * TRUNC\(15\.7\)
      * CHR\(67\)
      * CONCAT\('HAPPY '\, 'Birthday'\)
      * LOWER\('Birthday'\)
      * LPAD\('Page 1'\, 15\, '\*\.'\)
      * LTRIM\('Page 1'\, 'ae'\)
      * REPLACE\('JACK'\, 'J'\, 'BL'\)
      * RPAD\('Page 1'\, 15\, '\*\.'\)
      * RTRIM\('Page 1'\, 'ae'\)
      * SUBSTR\('ABCDEFG'\, 3\, 4\)
      * TRIM\(LEADING 0 FROM '00AA00'\)
      * UPPER\('Birthday'\)
      * ASCII\('A'\)
      * INSTR\('CORPORATE FLOOR'\,'OR'\, 3\, 2\)
      * LENGTH\('Birthday'\)
      * ADD\_MONTHS\('14/05/21'\, 1\)
      * LAST\_DAY\(SYSDATE\)
      * NEXT\_DAY\(SYSDATE\, ‘화’\)
      * ROUND\(SYSDATE\)
      * SYSDATE
      * TO\_CHAR\(SYSDATE\)
      * TO\_CHAR\(123\)
      * TO\_DATE\('12 05 2014'\, 'DD MM YYYY'\)
      * TO\_NUMBER\('12\.3'\)
      * DECODE\(1\,1\,'aa'\,'bb'\)
      * NULLIF\(123\, 345\)
      * NVL\(NULL\, 123\)


# 1.2 NULL 값 처리



* NULL 값이란?
  * 아직 지정되지 않은 값
  * NULL 값은 ‘0’\, ‘’ \(빈 문자\)\, ‘ ’ \(공백\) 등과 다른 특별한 값
  * NULL 값은 비교 연산자로 비교가 불가능함\.
  * NULL 값의 연산을 수행하면 결과 역시 NULL 값으로 반환됨\.
* 집계 함수를 사용할 때 주의할 점
  * ‘NULL\+숫자’ 연산의 결과는 NULL
  * 집계 함수 계산 시 NULL이 포함된 행은 집계에서 빠짐
  * 해당되는 행이 하나도 없을 경우 SUM\, AVG 함수의 결과는 NULL이 되며\, COUNT 함수의 결과는 0\.




* NULL 값에 대한 연산과 집계 함수
  * \(\* Mybook 테이블 생성은 웹페이지 스크립트 참조\)


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_21.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_22.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_23.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_24.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_25.jpg)



* NULL 값을 확인하는 방법 – IS NULL\, IS NOT NULL
  * NULL 값을 찾을 때는 ‘=’ 연산자가 아닌 ‘IS NULL’을 사용\,
  * NULL이 아닌 값을 찾을 때는 ‘＜＞’ 연산자가 아닌 ‘IS NOT NULL’을 사용함


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_26.jpg)



* NVL : NULL 값을 다른 값으로 대치하여 연산하거나 다른 값으로 출력
  * NVL\(속성\, 값\) 	/\* 속성 값이 NULL이면 '값'으로 대치한다 \*/


__질의 __  __4\-10  __  __ 이름__  __\, __  __전화번호가 포함된 고객목록을 __  __보이시오__  __\. __  __               __  __ __  __단__  __\, __  __전화번호가 없는 고객은 ‘__  __연락처없음__  __’ 으로 표시한다__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_27.jpg)

# 1.3 ROWNUM

내장 함수는 아니지만 자주 사용되는 문법임\.

<span style="color:#ff0000">오라클</span> 에서 내부적으로 생성되는 가상 컬럼으로 SQL 조회 결과의 순번을 나타냄\.

자료를 일부분만 확인하여 처리할 때 유용함\.

__질의 __  __4\-11  __  __고객 목록에서 고객번호__  __\, __  __이름__  __\, __  __전화번호를 앞의 두 명만 __  __보이시오__  __\. __

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_28.jpg)

# 연습문제



* Mybook 테이블을 생성하고 NULL에 관한 다음 SQL 문에 답하시오\.
  * 질의의 결과를 보면서 NULL에 대한 개념을 정리해보시오\.


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_29.png)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_30.png)

ROWNUM에 관한 다음 SQL 문에 답하시오\. 데이터는 마당서점 데이터베이스를 이용

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_31.png)

# 02. 부속질의

중첩질의 		– WHERE 부속질의

스칼라 부속질의 	– SELECT 부속질의

인라인 뷰 		– FROM 부속질의



* 부속질의\(subquery\)란?
  * 하나의 SQL 문 안에 다른 SQL 문이 중첩된nested 질의를 말함\.
  * 다른 테이블에서 가져온 데이터로 현재 테이블에 있는 정보를 찾거나 가공할 때 사용함\.
  * 보통 데이터가 대량일 때 데이터를 모두 합쳐서 연산하는 조인보다 필요한 데이터만 찾아서 공급해주는 부속질의가 성능이 더 좋음\.
  * 주 질의\(main query\, 외부질의\)와 부속질의\(sub query\, 내부질의\)로 구성됨\.


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_32.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_33.jpg)

# 2.1 중첩질의 – WHERE 부속질의

중첩질의\(nested subquery\)는 WHERE 절에서 사용되는 부속질의\.

WHERE 절은 보통 데이터를 선택하는 조건 혹은 술어\(predicate\)와 같이 사용됨\. 그래서 중첩질의를 술어 부속질의\(predicate subquery\)라고도 함\.

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_34.jpg)



* 비교 연산자
  * 부속질의가 반드시 단일 행\, 단일 열을 반환해야 하며\, 아닐 경우 질의를 처리할 수 없음\.


__질의 __  __4\-12   __  __평균 주문금액 이하의 주문에 대해서 주문번호와 금액을 __  __보이시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_35.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_36.jpg)

__질의 __  __4\-13   __  __각 고객의 평균 주문금액보다 큰 금액의 주문 내역에 대해서 주문번호__  __\, __  __고객번호__  __\, __  __                __  __금액을 __  __보이시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_37.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_38.jpg)



* IN\, NOT IN
  * IN 연산자는 주질의 속성 값이 부속질의에서 제공한 결과 집합에 있는지 확인\(check\)하는 역할을 함\. IN 연산자는 부속질의의 결과 다중 행을 가질 수 있음\. 주질의는 WHERE 절에 사용되는 속성 값을 부속질의의 결과 집합과 비교해 하나라도 있으면 참이 된다\. NOT IN은 이와 반대로 값이 존재하지 않으면 참이 됨\.


__질의 __  __4\-14   __  __대한민국에 거주하는 고객에게 판매한 도서의 총판매액을 __  __구하시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_39.jpg)



* ALL\, SOME\(ANY\)
  * ALL은 모두\, SOME\(ANY\)은 어떠한\(최소한 하나라도\)이라는 의미를 가짐\.
* 구문 구조


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_40.jpg)

__질의 __  __4\-15   3__  __번 고객이 주문한 도서의 최고 금액보다 더 비싼 도서를 구입한 주문의 __  __                 __  __주문번호와__  __ __  __금액을 __  __보이시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_41.jpg)



* EXISTS\, NOT EXISTS
  * 데이터의 존재 유무를 확인하는 연산자
  * 주질의에서 부속질의로 제공된 속성의 값을 가지고 부속질의에 조건을 만족하여 값이 존재하면 참이 되고\, 주질의는 해당 행의 데이터를 출력함\.
  * NOT EXIST의 경우 이와 반대로 동작함\.
* 구문 구조


__질의 __  __4\-16  EXISTS __  __연산자로 대한민국에 거주하는 고객에게 판매한 도서의 총 판매액을 __  __구하시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_42.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_43.png)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_44.png)

# 2.2 스칼라 부속질의 – SELECT 부속질의



* 스칼라 부속질의\(scalar subquery\)란?
  * SELECT 절에서 사용되는 부속질의로\, 부속질의의 결과 값을 단일 행\, 단일 열의 스칼라 값으로 반환함\.
  * 스칼라 부속질의는 원칙적으로 스칼라 값이 들어갈 수 있는 모든 곳에 사용 가능하며\, 일반적으로 SELECT 문과 UPDATE SET 절에 사용됨\.
  * 주질의와 부속질의와의 관계는 상관/비상관 모두 가능함\.


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_45.jpg)

__질의 __  __4\-17  __  __마당서점의 고객별 판매액을 __  __보이시오__  __\(__  __결과는 고객이름과 고객별 판매액을 출력__  __\)\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_46.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_47.jpg)



    * 먼저 Orders 테이블에 bookname 속성을 추가


__질의 __  __4\-18   Orders __  __테이블에 각 주문에 맞는 도서이름을 __  __입력하시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_48.jpg)

# 2.3 인라인 뷰- FROM 부속질의



* 인라인 뷰\(inline view\)란?
  * FROM 절에서 사용되는 부속질의\.
  * 테이블 이름 대신 인라인 뷰 부속질의를 사용하면 보통의 테이블과 같은 형태로 사용할 수 있음\.
  * 부속질의 결과 반환되는 데이터는 다중 행\, 다중 열이어도 상관없음\.
  * 다만 가상의 테이블인 뷰 형태로 제공되어 상관 부속질의로 사용될 수는 없음\.


__질의 __  __4\-19  __  __고객번호가 __  __2 __  __이하인 고객의 판매액을 __  __보이시오__  __               __  __\(__  __결과는 고객이름과 고객별 판매액 출력__  __\)__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_49.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_50.jpg)

# 연습문제



* 부속질의에 관한 다음 SQL 문을 수행해보고 어떤 질의에 대한 답인지 설명하시오\.


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_51.png)

# 03. 뷰

뷰의 생성

뷰의 수정

뷰의 삭제



* 뷰\(view\)는 하나 이상의 테이블을 합하여 만든 가상의 테이블\.
* 장점
  * <span style="color:#ff0000">편리성</span>  <span style="color:#ff0000">\(</span>  및  <span style="color:#ff0000">재사용성</span> \)  : 자주 사용되는 복잡한 질의를 뷰로 미리 정의해 놓을 수 있음\.
  * => 복잡한 질의를 간단히 작성\, 미리 정의된 뷰를 일반 테이블처럼 사용하여 편리함
  * <span style="color:#ff0000">보안성</span>  : 각 사용자별로 필요한 데이터만 선별하여 보여줄 수 있음\. 중요한 질의의 경우 질의             내용을 암호화할 수 있음\.
  * => 개인정보\(주민번호\)나 급여\, 건강 같은 민감한 정보를 제외한 테이블을 만들어 사용
  * <span style="color:#ff0000">논리적 데이터</span>  <span style="color:#ff0000"> </span>  <span style="color:#ff0000">독립성</span>  제공 :
  * => 개념 스키마의 데이터베이스 구조가 변하여도 외부 스키마에 영향을 주지 않도록하는          논리적 데이터 독립성 제공
* 뷰의 특징
  * 1\. 원본 데이터 값에 따라 같이 변함
  * 2\. 독립적인 인덱스 생성이 어려움
  * 3\. 삽입\, 삭제\, 갱신 연산에 많은 제약이 따름


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_52.jpg)

# 3.1 뷰의 생성

기본 문법

Book 테이블에서 ‘축구’라는 문구가 포함된 자료만 보여주는 뷰

위 SELECT 문을 이용해 작성한 뷰 정의문

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_53.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_54.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_55.jpg)

__질의 __  __4\-20  __  __주소에 ‘__  __대한민국’을__  __ 포함하는 고객들로 구성된 뷰를 만들고 __  __조회하시오__  __\. __  __               __  __뷰의 이름은 __  __vw__  __\_ Customer__  __로 __  __설정하시오__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_56.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_57.jpg)

__질의 __  __4\-21  Orders __  __테이블에 고객이름과 도서이름을 바로 확인할 수 있는 뷰를 생성한 후__  __\, __  __              ‘__  __김연아’ 고객이 구입한 도서의 주문번호__  __\, __  __도서이름__  __\, __  __주문액을 __  __보이시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_58.png)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_59.png)

# 3.2 뷰의 수정



* 기본 문법
  * 결과확인


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_60.jpg)

__질의 __  __4\-22  \[__  __질의 __  __4\-20\]__  __에서 생성한 뷰 __  __vw\_Customer__  __는 주소가 대한민국인 고객을 보여준다__  __\. __  __               __  __이 뷰를 영국을 주소로 가진 고객으로 __  __변경하시오__  __\. __  __	__  __phone __  __속성은 필요 없으므로 포함시키지 __  __마시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_61.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_62.jpg)

# 3.3 뷰의 삭제



* 기본 문법
  * 결과확인


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_63.jpg)

__질의 __  __4\-23  __  __앞서 생성한 뷰 __  __vw\_Customer__  __를 __  __삭제하시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_64.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_65.jpg)

# 연습문제

__08\. __  __다음에 해당하는 __  __뷰를__  __ 작성하시오__  __\. __  __데이터베이스는 __  __마당서점__  __ __  __데이터베이스를 이용한다__  __\.__

\(1\) 판매가격이 20\,000원 이상인 도서의 도서번호\, 도서이름\, 고객이름\, 출판사\, 판매가격을 보여주는 highorders 뷰를 생성하시오\.

\(2\) 생성한 뷰를 이용하여 판매된 도서의 이름과 고객의 이름을 출력하는 SQL 문을 작성하시오\.

\(3\) highorders 뷰를 변경하고자 한다\. 판매가격 속성을 삭제하는 명령을 수행하시오\. 삭제 후 \(2\)번 SQL 문을 다시 수행하시오\.

# 04. 인덱스

데이터베이스의 물리적 저장

인덱스와 B\-tree

오라클 인덱스

인덱스의 생성

인덱스의 재구성과 삭제

# 4.1 데이터베이스의 물리적 저장

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_66.jpg)



* 실제 데이터가 저장되는 곳은 보조기억장치
  * 하드디스크\, SSD\, USB 메모리 등
* 가장 많이 사용되는 장치는 하드디스크
  * 하드디스크는 원형의 플레이트\(plate\)로 구성되어 있고\, 이 플레이트는 논리적으로 트랙으로 나뉘며 트랙은 다시 몇 개의 섹터로 나뉨\.
  * 원형의 플레이트는 초당 빠른 속도로 회전하고\, 회전하는 플레이트를 하드디스크의 액세스 암\(arm\)과 헤더\(header\)가 접근하여 원하는 섹터에서 데이터를 가져옴\.
  * 하드디스크에 저장된 데이터를 읽어 오는 데 걸리는 시간은 모터\(motor\)에 의해서 분당 회전하는 속도\(RPM\, Revolutions Per Minute\)\, 데이터를 읽을 때 액세스 암이 이동하는 시간\(latency time\)\, 주기억장치로 읽어오는 시간\(transfer time\)에 영향을 받음\.




* 액세스 시간\(access time\)
  * 액세스 시간 = 탐색시간\(seek time\, 액세스 헤드를 트랙에 이동시키는 시간\)
    * \+ 회전지연시간\(rotational latency time\, 섹터가 액세스 헤드에 접근하는 시간\)
    * \+ 데이터 전송시간\(data transfer time\, 데이터를 주기억장치로 읽어오는 시간\)


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_67.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_68.png)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_69.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_70.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_71.jpg)

# 4.2 인덱스와 B-tree



* 인덱스의 필요성질의 검색시 data block\(여러 개의 record를 저장하는 저장단위\, 2KB 4KB …\) 읽는 횟수를 최소화 필요disk에 있는 데이터는 memory에 있는 데이터에 비하여 읽어들이는 속도가  <span style="color:#ff0000">10000</span> 배 정도 소요된다\.


memory

GB단위

70ns\-100ns

SSD

GB단위

7μs\-150 μs

HDD보다 10배정도 빠름

Hard Disk

TB단위

1ms\-10ms

㈜ https://www\.formulusblack\.com/blog/compute\-performance\-distance\-of\-data\-as\-a\-measure\-of\-latency/



* 인덱스의 필요성 memory




* 인덱스\(index\, 색인\)
  * 도서의 색인이나 사전과 같이 데이터를 쉽고 빠르게 찾을 수 있도록 만든 데이터 구조


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_72.jpg)



* 인덱스의 특징
  * 인덱스는 테이블에서 한 개 이상의 속성을 이용하여 생성함\.
  * 빠른 검색과 함께 효율적인 레코드 접근이 가능함\.
  * 순서대로 정렬된 속성과 데이터의 위치만 보유하므로 테이블보다 작은 공간을 차지함\.
  * 저장된 값들은 테이블의 부분집합이 됨\.
  * 일반적으로 B\-tree 형태의 구조를 가짐\.
  * 데이터의 수정\, 삭제 등의 변경이 발생하면 인덱스의 재구성이 필요함\.


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_73.jpg)

# 오라클 B-tree 인덱스



* 오라클 인덱스는 B\-tree를 변형하여 사용하며 명칭은 B\-tree로 동일한 이름으로 부름


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_74.jpg)

# 4.2 인덱스와 B-tree

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_75.jpg)

# 4.4 인덱스의 생성



* 인덱스 생성 시 고려사항
  * 인덱스는 WHERE 절에 자주 사용되는 속성이어야 함\.
  * 인덱스는 조인에 자주 사용되는 속성이어야 함\.
  * 단일 테이블에 인덱스가 많으면 속도가 느려질 수 있음\(테이블 당 4~5개 정도 권장\)\.
  * 속성이 가공되는 경우 사용하지 않음\.
  * 속성의 선택도가 낮을 때 유리함\(속성의 모든 값이 다른 경우\)\.
* 인덱스의 생성 문법


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_76.jpg)

__질의 __  __4\-24   Book __  __테이블의 __  __bookname__  __ __  __열을 대상으로 비 클러스터 인덱스 __  __ix\_Book__  __을 생성하라__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_77.jpg)

__질의 __  __4\-25   Book __  __테이블의 __  __publisher\, price __  __열을 대상으로 인덱스 __  __ix\_Book2__  __를 __  __생성하시오__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_78.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_79.jpg)



* 인덱스의 재구성은 ALTER INDEX 명령을 사용함\.
  * 생성 문법
  * 삭제 문법


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_80.jpg)

__질의 __  __4\-26   __  __인덱스 __  __ix\_Book__  __을 __  __재생성하시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_81.jpg)

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_82.jpg)

__질의 __  __4\-27  __  __인덱스 __  __ix\_Book__  __을 __  __삭제하시오__  __\.__

![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_83.jpg)

# 연습문제



* \[마당서점 데이터베이스 인덱스\] 마당서점 데이터베이스에서 다음 SQL 문을  수행하고  데이터베이스가 인덱스를 사용하는 과정을 확인하시오\.
  * \(1\) 다음 SQL 문을 수행해본다\.
  * \(2\) 실행 계획을 살펴본다\. 실행 계획은 \[F10\]키를 누른 후 \[계획 설명\]탭을 선택하면
  * 표시된다\.
  * \(3\) Customer 테이블에 name으로 인덱스를 생성하시오\. 생성 후 \(1\)번의 질의를 다시
  * 수행하고 실행 계획을 살펴보시오\.
  * \(4\) 같은 질의에 대한 두 가지 실행 계획을 비교해보시오\.
  * \(5\) \(3\)번에서 생성한 인덱스를 삭제하시오\.


![image](img%5C4%EC%9E%A5%20SQL%20%EA%B3%A0%EA%B8%89_84.png)

# 요약

내장 함수

부속질의

뷰

인덱스

B\-tree

오라클 인덱스의 종류

